<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tùy chỉnh & Mua sắm</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Spartan:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./assets/css/styles.css" />
    <style>
      .custom-shop-container {
        max-width: 1320px;
        margin-inline: auto;
        padding-inline: 0.75rem;
        padding-block: 2rem;
      }

      .custom-shop-section {
        padding: 1.5rem;
        background-color: var(--body-color);
        border: 1px solid var(--border-color-alt);
        border-radius: 0.25rem;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 1.5rem;
      }

      .canvas-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
      }

      #designCanvas {
        border: 1px solid var(--border-color);
        background: var(--body-color);
        width: 100%;
        height: 400px;
      }

      .canvas-controls {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .svg-section {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 1rem;
      }

      #tshirt path {
        transition: fill 0.3s var(--transition);
      }

      .drag-drop-section {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 1.5rem;
      }

      .products {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
      }

      .product {
        padding: 0.625rem;
        background: var(--body-color);
        border: 1px solid var(--border-color);
        border-radius: 0.25rem;
        text-align: center;
        cursor: move;
        transition: transform 0.2s var(--transition);
      }

      .product:hover {
        transform: scale(1.05);
      }

      #cart {
        border: 2px dashed var(--border-color);
        min-height: 200px;
        padding: 1rem;
        background: var(--container-color);
        border-radius: 0.25rem;
      }

      .cart-item {
        animation: slideIn 0.5s ease;
        color: var(--text-color);
        font-size: var(--small-font-size);
      }

      .geo-section {
        text-align: center;
      }

      @keyframes slideIn {
        from {
          transform: translateY(-20px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      @media screen and (max-width: 768px) {
        .canvas-section {
          grid-template-columns: 1fr;
        }
        .drag-drop-section {
          grid-template-columns: 1fr;
        }
        #designCanvas {
          height: 200px;
        }
      }
    </style>
  </head>
  <body>
    <!--=============== HEADER ===============-->
    <header class="header">
      <div class="header__top">
        <div class="header__container container">
          <div class="header__contact">
            <span>(+01) - 2345 - 6789</span>
            <span>Our location</span>
          </div>
          <p class="header__alert-news">
            Super Values Deals - Save more coupons
          </p>
          <a href="login-register.html" class="header__top-action">
            Log In / Sign Up
          </a>
        </div>
      </div>

      <nav class="nav container">
        <a href="index.html" class="nav__logo">
          <img
            class="nav__logo-img"
            src="assets/img/logo.svg"
            alt="website logo"
          />
        </a>
        <div class="nav__menu" id="nav-menu">
          <ul class="nav__list">
            <li class="nav__item">
              <a href="index.html" class="nav__link">Home</a>
            </li>
            <li class="nav__item">
              <a href="shop.html" class="nav__link">Shop</a>
            </li>
            <li class="nav__item">
              <a href="accounts.html" class="nav__link">My Account</a>
            </li>
            <li class="nav__item">
              <a href="compare.html" class="nav__link active-link">Compare</a>
            </li>
            <li class="nav__item">
              <a href="custome-shop.html" class="nav__link">Custom</a>
            </li>
            <li class="nav__item">
              <a href="login-register.html" class="nav__link">Login</a>
            </li>
          </ul>
          <div class="header__search">
            <input
              type="text"
              placeholder="Search For Items..."
              class="form__input"
            />
            <button class="search__btn">
              <img src="assets/img/search.png" alt="search icon" />
            </button>
          </div>
        </div>
        <div class="header__user-actions">
          <a href="wishlist.html" class="header__action-btn" title="Wishlist">
            <img src="assets/img/icon-heart.svg" alt="" />
            <span class="count">3</span>
          </a>
          <a href="cart.html" class="header__action-btn" title="Cart">
            <img src="assets/img/icon-cart.svg" alt="" />
            <span class="count">3</span>
          </a>
        </div>
      </nav>
    </header>

    <div class="custom-shop-container">
      <h1 class="section__title">Custom & Shopping <span></span></h1>

      <!-- Canvas Section -->
      <section class="custom-shop-section canvas-section">
        <div>
          <h2 class="section__title">Custom</h2>
          <canvas id="designCanvas"></canvas>
        </div>
        <div class="canvas-controls">
          <button class="btn btn--md" onclick="clearCanvas()">
            Clear Canvas
          </button>
          <button class="btn btn--md" onclick="saveDesign()">
            Save Design
          </button>
        </div>
      </section>

      <!-- SVG Section -->
      <section class="custom-shop-section svg-section">
        <h2 class="section__title">Choose Color</h2>
        <svg id="tshirt" width="100" height="100">
          <path
            d="M20,20 L40,20 L50,30 L60,20 L80,20 L80,80 L20,80 Z"
            fill="var(--body-color)"
            stroke="var(--border-color)"
          />
        </svg>
        <button class="btn btn--sm" onclick="changeColor('#F77E87')">
          Red
        </button>
        <button
          class="btn btn--sm"
          onclick="changeColor('var(--second-color)')"
        >
          Yellow
        </button>
        <button class="btn btn--sm" onclick="changeColor('#0000FF')">
          Blue
        </button>
      </section>

      <!-- Drag and Drop Section -->
      <section class="custom-shop-section drag-drop-section">
        <div>
          <h2 class="section__title">Products List</h2>
          <div class="products">
            <div
              class="product"
              draggable="true"
              data-id="1"
              data-name="Áo thun"
              data-price="200000"
            >
              <img src="./assets/img/product-1-1.jpg" alt="Áo thun" />
              <p class="new__price">Colorful Pattern Shirts - $29.99</p>
            </div>
            <div
              class="product"
              draggable="true"
              data-id="2"
              data-name="Quần jeans"
              data-price="500000"
            >
              <img src="./assets/img/product-4-1.jpg" alt="Quần jeans" />
              <p class="new__price"></p>
            </div>
          </div>
        </div>
        <div>
          <h2 class="section__title">Cart</h2>
          <div id="cart" ondrop="drop(event)" ondragover="allowDrop(event)">
            <p>Drag and drop products here</p>
          </div>
        </div>
      </section>

      <!-- Geo Location Section -->
      <section class="custom-shop-section geo-section">
        <h2 class="section__title">Find store near you</h2>
        <button class="btn btn--md" onclick="getLocation()">File store</button>
        <p id="storeInfo"></p>
      </section>
    </div>

    <script>
      // Canvas
      const canvas = document.getElementById('designCanvas');
      const ctx = canvas.getContext('2d');
      canvas.width = canvas.clientWidth;
      canvas.height = canvas.clientHeight;
      let isDrawing = false;

      canvas.addEventListener('mousedown', () => {
        isDrawing = true;
        ctx.beginPath();
      });

      canvas.addEventListener('mousemove', (e) => {
        if (!isDrawing) return;
        ctx.lineTo(e.offsetX, e.offsetY);
        ctx.strokeStyle = 'var(--first-color)';
        ctx.lineWidth = 2;
        ctx.stroke();
      });

      canvas.addEventListener('mouseup', () => {
        isDrawing = false;
      });

      function clearCanvas() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      }

      function saveDesign() {
        const design = canvas.toDataURL();
        localStorage.setItem('customDesign', design);
        alert('Thiết kế đã được lưu!');
      }

      window.onload = () => {
        const savedDesign = localStorage.getItem('customDesign');
        if (savedDesign) {
          const img = new Image();
          img.src = savedDesign;
          img.onload = () => ctx.drawImage(img, 0, 0);
        }
      };

      // SVG
      function changeColor(color) {
        const tshirt = document.getElementById('tshirt').querySelector('path');
        tshirt.setAttribute('fill', color);
      }

      // Drag and Drop
      function allowDrop(e) {
        e.preventDefault();
      }

      document.querySelectorAll('.product').forEach((product) => {
        product.addEventListener('dragstart', (e) => {
          e.dataTransfer.setData('id', e.target.dataset.id);
          e.dataTransfer.setData('name', e.target.dataset.name);
          e.dataTransfer.setData('price', e.target.dataset.price);
        });
      });

      function drop(e) {
        e.preventDefault();
        const id = e.dataTransfer.getData('id');
        const name = e.dataTransfer.getData('name');
        const price = e.dataTransfer.getData('price');

        let cart = JSON.parse(localStorage.getItem('cart') || '[]');
        cart.push({ id, name, price });
        localStorage.setItem('cart', JSON.stringify(cart));

        const cartDiv = document.getElementById('cart');
        cartDiv.innerHTML = '';
        cart.forEach((item) => {
          cartDiv.innerHTML += `<p class="cart-item">${item.name} - ${item.price}đ</p>`;
        });
      }

      // Geo Location
      function getLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(showStore, showError);
        } else {
          document.getElementById('storeInfo').innerText =
            'Trình duyệt không hỗ trợ Geo Location.';
        }
      }

      function showStore(position) {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;

        const stores = [
          { name: 'Cửa hàng Quận 1', lat: 10.7769, lon: 106.7009 },
          { name: 'Cửa hàng Quận 7', lat: 10.7299, lon: 106.7213 },
        ];

        let nearestStore = stores[0];
        let minDistance = Math.sqrt(
          (lat - stores[0].lat) ** 2 + (lon - stores[0].lon) ** 2
        );

        stores.forEach((store) => {
          const distance = Math.sqrt(
            (lat - store.lat) ** 2 + (lon - store.lon) ** 2
          );
          if (distance < minDistance) {
            minDistance = distance;
            nearestStore = store;
          }
        });

        document.getElementById(
          'storeInfo'
        ).innerText = `Cửa hàng gần nhất: ${nearestStore.name}`;
      }

      function showError(error) {
        if (error.code === 1) {
          document.getElementById('storeInfo').innerText =
            'Vui lòng cấp quyền truy cập vị trí trong cài đặt trình duyệt.';
        } else {
          document.getElementById('storeInfo').innerText =
            'Không thể lấy vị trí của bạn.';
        }
      }
    </script>
  </body>
</html>
